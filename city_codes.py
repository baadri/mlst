# city_codes.py - словарь соответствия IATA-кодов и городов

CITY_TO_IATA = {
    "санкт-петербург": "LED", 
    "анадырь": "DYR",
    "сочи": "AER",
    "актау": "SCO",
    "актобе": "AKX",
    "алания": "GZP",
    "аликанте": "ALC",
    "алматы": "ALA",
    "амстердам": "AMS",
    "анкара": "ANK",
    "анталья": "AYT",
    "апатиты": "KVK",
    "архангельск": "ARH",
    "астана": "NQZ",
    "астрахань": "ASF",
    "атырау": "GUW",
    "афины": "ATH",
    "баку": "BAK",
    "бангкок": "BKK",
    "барнаул": "BAX",
    "барселона": "BCN",
    "бейрут": "BEY",
    "белград": "BEG",
    "берлин": "BER",
    "бишкек": "FRU",
    "благовещенск": "BQS",
    "богучаны": "BGS",
    "бодрум": "BJV",
    "болонья": "BLQ",
    "брест": "BQT",
    "брюссель": "BRU",
    "будапешт": "BUD",
    "бургас": "BOJ",
    "бухара": "BHK",
    "бухарест": "BUH",
    "буэнос-айрес": "BUE",
    "ванавара": "VAQ",
    "варадеро": "VRA",
    "варна": "VAR",
    "варшава": "WAW",
    "вашингтон": "WAS",
    "вена": "VIE",
    "венеция": "VCE",
    "вильнюс": "VNO",
    "владивосток": "VVO",
    "владикавказ": "OGZ",
    "волгоград": "VOG",
    "воронеж": "VOZ",
    "гавана": "HAV",
    "гамбург": "HAM",
    "ганновер": "HAJ",
    "гвадалахара": "GDL",
    "гоа": "GOI",
    "гомель": "GME",
    "гонконг": "HKG",
    "горно-алтайск": "RGK",
    "грозный": "GRV",
    "гуанчжоу": "CAN",
    "гюмри": "LWN",
    "гянджа": "KVD",
    "даламан": "DLM",
    "далянь": "DLC",
    "дели": "DEL",
    "денпасар бали": "DPS",
    "джакарта": "JKT",
    "доха": "DOH",
    "дрезден": "DRS",
    "дубай": "DXB",
    "дублин": "DUB",
    "дубровник": "DBV",
    "душанбе": "DYU",
    "дюссельдорф": "DUS",
    "екатеринбург": "SVX",
    "ереван": "EVN",
    "женева": "GVA",
    "загреб": "ZAG",
    "зальцбург": "SZG",
    "зея": "EYA",
    "игарка": "IAA",
    "ижевск": "IJK",
    "измир": "IZM",
    "инсбрук": "INN",
    "ираклион": "HER",
    "иркутск": "IKT",
    "казань": "KZN",
    "каир": "CAI",
    "калининград": "KGD",
    "канкун": "CUN",
    "караганда": "KGF",
    "касабланка": "CAS",
    "кемерово": "KEJ",
    "киров": "KVX",
    "кодинск": "KNY",
    "коломбо": "CMB",
    "копенгаген": "CPH",
    "костанай": "KSN",
    "красноярск": "KJA",
    "куньмин": "KMG",
    "кызыл": "KYZ",
    "кызылорда": "KZO",
    "ларнака": "LCA",
    "ленск": "ULK",
    "лион": "LYS",
    "лиссабон": "LIS",
    "лондон": "LON",
    "лос-анджелес": "LAX",
    "любляна": "LJU",
    "маврикий": "MRU",
    "магадан": "GDX",
    "магас": "IGT",
    "магнитогорск": "MQF",
    "мадрид": "MAD",
    "майами": "MIA",
    "малага": "AGP",
    "мале": "MLE",
    "мальта": "MLA",
    "марсель": "MRS",
    "маскат": "MCT",
    "махачкала": "MCX",
    "маэ сейшелы": "SEZ",
    "мерсин": "QIN",
    "мехико": "MEX",
    "милан": "MIL",
    "минеральные воды": "MRV",
    "минск": "MSQ",
    "мирный": "MJZ",
    "могилев": "MVQ",
    "монастир": "MIR",
    "монреаль": "YMQ",
    "москва": "MOW",
    "мотыгино": "MJY",
    "мумбай": "BOM",
    "мурманск": "MMK",
    "мюнхен": "MUC",
    "нальчик": "NAL",
    "неаполь": "NAP",
    "нижнеангарск": "NZG",
    "нижневартовск": "NJC",
    "нижнекамск": "NBC",
    "нижний новгород": "GOJ",
    "николаевск-на-амуре": "NLI",
    "ницца": "NCE",
    "новокузнецк": "NOZ",
    "новосибирск": "OVB",
    "новый уренгой": "NUX",
    "нью-Йорк": "NYC",
    "нячанг": "NHA",
    "омск": "OMS",
    "оренбург": "REN",
    "орск": "OSW",
    "осака": "OSA",
    "осло": "OSL",
    "остров итуруп": "ITU",
    "ош": "OSS",
    "павлодар": "PWQ",
    "пальма-де-мальорка": "PMI",
    "париж": "PAR",
    "пекин": "BJS",
    "пенза": "PEZ",
    "пермь": "PEE",
    "петрозаводск": "PES",
    "петропавловск-камчатский": "PKC",
    "полярный": "PYJ",
    "прага": "PRG",
    "пула": "PUY",
    "пунта-кана": "PUJ",
    "пхукет": "HKT",
    "рейкьявик": "REK",
    "рига": "RIX",
    "рим": "ROM",
    "рио-де-жанейро": "RIO",
    "салоники": "SKG",
    "самара": "KUF",
    "самарканд": "SKD",
    "санкт-петербург": "LED",
    "санья хайнань": "SYX",
    "саппоро": "SPK",
    "саранск": "SKX",
    "саратов": "RTW",
    "светлогорск": "SES",
    "северо-енисейский": "VEO",
    "сеул": "SEL",
    "сингапур": "SIN",
    "сиэтл": "SEA",
    "советская гавань": "GVN",
    "софия": "SOF",
    "сплит": "SPU",
    "ставрополь": "STW",
    "стамбул": "IST",
    "стокгольм": "STO",
    "страсбург": "SXB",
    "сургут": "SGC",
    "сыктывкар": "SCW",
    "таксимо": "TKM",
    "талакан": "TLK",
    "таллин": "TLL",
    "тамчы": "IKU",
    "ташкент": "TAS",
    "тегеран": "THR",
    "тель-авив": "TLV",
    "тенерифе": "TCI",
    "тиват": "TIV",
    "тобольск": "TOX",
    "токио": "TYO",
    "томск": "TOF",
    "торонто": "YTO",
    "трабзон": "TZX",
    "тура": "GOY",
    "туруханск": "THX",
    "тында": "TYD",
    "тюмень": "TJM",
    "улан-батор": "ULN",
    "улан-удэ": "UUD",
    "ульяновск": "ULY",
    "ургенч": "UGC",
    "усть-каменогорск": "UKK",
    "уфа": "UFA",
    "фергана": "FEG",
    "форт майерс пейдж": "FMY",
    "франкфурт": "FRA",
    "фукуок": "PQC",
    "хабаровск": "KHV",
    "ханой": "HAN",
    "ханты-мансийск": "HMA",
    "харбин": "HRB",
    "хартум": "KRT",
    "хатанга": "HTG",
    "хельсинки": "HEL",
    "хошимин": "SGN",
    "хургада": "HRG",
    "цюрих": "ZRH",
    "чара": "CZR",
    "чебоксары": "CSY",
    "челябинск": "CEK",
    "чикаго": "CHI",
    "чита": "HTA",
    "чэнду": "CTU",
    "шанхай": "SHA",
    "шарджа": "SHJ",
    "шарм эль шейх": "SSH",
    "штутгарт": "STR",
    "шымкент": "CIT",
    "элиста": "ESL",
    "южно-сахалинск": "UUS",
    "якутск": "YKS",
    "янбу": "YNB",
    "ярославль": "IAR",
    "ярцево": "YAE",
    "поселок бор": "TGP",
    "аддис-абеба": "ADD",
    "акрон-кантон": "CAK",
    "алжир": "ALG",
    "амман": "AMM",
    "анапа": "AAQ",
    "атланта": "ATL",
    "ашхабад": "ASB",
    "багдад": "BGW",
    "базель": "BSL",
    "банги": "BGF",
    "бахрейн": "BAH",
    "белгород": "EGO",
    "бостон": "BOS",
    "братислава": "BTS",
    "братск": "BTK",
    "бристоль": "BRS",
    "бурбанк": "BUR",
    "ванкувер": "YVR",
    "геленджик": "GDZ",
    "дамаск": "DAM",
    "дар-эс-салам": "DAR",
    "денвер": "DEN",
    "детройт": "DTT",
    "джайпур": "JAI",
    "джидда": "JED",
    "ибица": "IBZ",
    "игуаcу": "IGR",
    "Йоханнесбург": "JNB",
    "кайсери": "ASR",
    "кейптаун": "CPT",
    "комсомольск-на-амуре": "KXK",
    "кох самуи": "USM",
    "краснодар": "KRR",
    "куала-лумпур": "KUL",
    "кувейт": "KWI",
    "лас-вегас": "LAS",
    "лафайет": "LFT",
    "лима": "LIM",
    "люксембург": "LUX",
    "манчестер": "MAN",
    "марракеш": "RAK",
    "мельбурн": "MEL",
    "миннеаполис": "MSP",
    "найроби": "NBO",
    "нарьян-мар": "NNM",
    "нерюнгри": "NER",
    "ноглики": "NGK",
    "норильск": "NSK",
    "ньюарк": "EWR",
    "окленд": "AKL",
    "оха": "OHH",
    "подгорица": "TGD",
    "райпур": "RPR",
    "ростов-на-дону": "ROV",
    "салехард": "SLY",
    "сан-франциско": "SFO",
    "себу мактан": "CEB",
    "сидней": "SYD",
    "симферополь": "SIP",
    "сичан": "XIC",
    "скопье": "SKP",
    "тбилиси": "TBS",
    "тунис": "TUN",
    "урумчи": "URC",
    "шахтерск": "EKS",
    "эдинбург": "EDI",
    "эр-рияд": "RUH",
    "южно-курильск": "DEE",
}

def find_city(query, max_results=5):
    """
    Поиск города по части названия или коду IATA
    
    Args:
        query (str): Часть названия города или код IATA
        max_results (int): Максимальное количество результатов
        
    Returns:
        list: Список подходящих городов [(город, код), ...]
    """
    query = query.lower()
    matches = []
    
    # Если это похоже на IATA-код (3 буквы), ищем обратное соответствие
    if len(query) == 3 and query.isalpha():
        query_upper = query.upper()
        for city, code in CITY_TO_IATA.items():
            if code == query_upper:
                return [(city.capitalize(), code)]  # Если нашли точное совпадение, сразу возвращаем
            elif code.startswith(query[0].upper()):
                matches.append((city.capitalize(), code))
                if len(matches) >= max_results:
                    break
    
    # Иначе ищем совпадения по названию города
    else:
        for city, code in CITY_TO_IATA.items():
            if query in city:
                matches.append((city.capitalize(), code))
                if len(matches) >= max_results:
                    break
    
    # Если ничего не нашлось по названию, пробуем найти по первым буквам
    if not matches and len(query) >= 2:
        for city, code in CITY_TO_IATA.items():
            if city.startswith(query):
                matches.append((city.capitalize(), code))
                if len(matches) >= max_results:
                    break
    
    return matches
